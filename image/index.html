<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="A library to accelerate image processing using CUDA in Python."><meta name=author content="Beltrán Offerrall"><link rel=prev href=..><link href=../io/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.0"><title>Image - pyimagecuda</title><link rel=stylesheet href=../assets/stylesheets/main.618322db.min.css><link rel=stylesheet href=../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../assets/_mkdocstrings.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#image-memory class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title=pyimagecuda class="md-header__button md-logo" aria-label=pyimagecuda data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> pyimagecuda </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Image </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <div class=md-header__source> <a href=https://github.com/offerrall/pyimagecuda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> pyimagecuda </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Image </a> </li> <li class=md-tabs__item> <a href=../io/ class=md-tabs__link> Load and Save </a> </li> <li class=md-tabs__item> <a href=../opengl/ class=md-tabs__link> OpenGL </a> </li> <li class=md-tabs__item> <a href=../fill/ class=md-tabs__link> Fill </a> </li> <li class=md-tabs__item> <a href=../text/ class=md-tabs__link> Text </a> </li> <li class=md-tabs__item> <a href=../blend/ class=md-tabs__link> Blend </a> </li> <li class=md-tabs__item> <a href=../resize/ class=md-tabs__link> Resize </a> </li> <li class=md-tabs__item> <a href=../filter/ class=md-tabs__link> Filter </a> </li> <li class=md-tabs__item> <a href=../effect/ class=md-tabs__link> Effect </a> </li> <li class=md-tabs__item> <a href=../adjust/ class=md-tabs__link> Adjust </a> </li> <li class=md-tabs__item> <a href=../transform/ class=md-tabs__link> Transform </a> </li> <li class=md-tabs__item> <a href=../benchmarks/ class=md-tabs__link> Benchmarks </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title=pyimagecuda class="md-nav__button md-logo" aria-label=pyimagecuda data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg> </a> pyimagecuda </label> <div class=md-nav__source> <a href=https://github.com/offerrall/pyimagecuda title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg> </div> <div class=md-source__repository> pyimagecuda </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Image </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Image </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#image-types class=md-nav__link> <span class=md-ellipsis> Image Types </span> </a> <nav class=md-nav aria-label="Image Types"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#image-float32-precision class=md-nav__link> <span class=md-ellipsis> Image - Float32 Precision </span> </a> </li> <li class=md-nav__item> <a href=#imageu8-8-bit-precision class=md-nav__link> <span class=md-ellipsis> ImageU8 - 8-bit Precision </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#memory-management class=md-nav__link> <span class=md-ellipsis> Memory Management </span> </a> <nav class=md-nav aria-label="Memory Management"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#1-automatic-garbage-collection class=md-nav__link> <span class=md-ellipsis> 1. Automatic (Garbage Collection) </span> </a> </li> <li class=md-nav__item> <a href=#2-explicit-with-context-managers class=md-nav__link> <span class=md-ellipsis> 2. Explicit with Context Managers </span> </a> </li> <li class=md-nav__item> <a href=#3-manual-control class=md-nav__link> <span class=md-ellipsis> 3. Manual Control </span> </a> </li> <li class=md-nav__item> <a href=#4-handling-out-of-memory class=md-nav__link> <span class=md-ellipsis> 4. Handling Out of Memory </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#buffer-reuse class=md-nav__link> <span class=md-ellipsis> Buffer Reuse </span> </a> <nav class=md-nav aria-label="Buffer Reuse"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#example-gaussian-blur class=md-nav__link> <span class=md-ellipsis> Example: Gaussian Blur </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#dynamic-buffer-sizing class=md-nav__link> <span class=md-ellipsis> Dynamic Buffer Sizing </span> </a> </li> <li class=md-nav__item> <a href=#best-practices class=md-nav__link> <span class=md-ellipsis> Best Practices </span> </a> <nav class=md-nav aria-label="Best Practices"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#for-simple-scripts class=md-nav__link> <span class=md-ellipsis> For Simple Scripts </span> </a> </li> <li class=md-nav__item> <a href=#for-batch-processing class=md-nav__link> <span class=md-ellipsis> For Batch Processing </span> </a> </li> <li class=md-nav__item> <a href=#for-videoreal-time class=md-nav__link> <span class=md-ellipsis> For Video/Real-time </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#memory-considerations class=md-nav__link> <span class=md-ellipsis> Memory Considerations </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../io/ class=md-nav__link> <span class=md-ellipsis> Load and Save </span> </a> </li> <li class=md-nav__item> <a href=../opengl/ class=md-nav__link> <span class=md-ellipsis> OpenGL </span> </a> </li> <li class=md-nav__item> <a href=../fill/ class=md-nav__link> <span class=md-ellipsis> Fill </span> </a> </li> <li class=md-nav__item> <a href=../text/ class=md-nav__link> <span class=md-ellipsis> Text </span> </a> </li> <li class=md-nav__item> <a href=../blend/ class=md-nav__link> <span class=md-ellipsis> Blend </span> </a> </li> <li class=md-nav__item> <a href=../resize/ class=md-nav__link> <span class=md-ellipsis> Resize </span> </a> </li> <li class=md-nav__item> <a href=../filter/ class=md-nav__link> <span class=md-ellipsis> Filter </span> </a> </li> <li class=md-nav__item> <a href=../effect/ class=md-nav__link> <span class=md-ellipsis> Effect </span> </a> </li> <li class=md-nav__item> <a href=../adjust/ class=md-nav__link> <span class=md-ellipsis> Adjust </span> </a> </li> <li class=md-nav__item> <a href=../transform/ class=md-nav__link> <span class=md-ellipsis> Transform </span> </a> </li> <li class=md-nav__item> <a href=../benchmarks/ class=md-nav__link> <span class=md-ellipsis> Benchmarks </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=image-memory>Image &amp; Memory</h1> <p>PyImageCUDA provides two image types and flexible memory management for GPU buffers.</p> <hr> <h2 id=image-types>Image Types</h2> <h3 id=image-float32-precision><code>Image</code> - Float32 Precision</h3> <p>Primary image type for all operations. Stores RGBA data in 32-bit floating point (0.0 to 1.0 range). <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=c1># Create a new image</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=n>width</span><span class=o>=</span><span class=mi>1920</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>1080</span><span class=p>)</span>
</span></code></pre></div></p> <div class="admonition warning"> <p class=admonition-title>Uninitialized Memory</p> <p>Newly created images contain <strong>uninitialized GPU memory</strong> with random data. Always initialize before use with <code>Fill.color()</code> or load data explicitly.</p> </div> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>    <span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>    <span class=n>Fill</span><span class=o>.</span><span class=n>color</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span>  <span class=c1># Clear to transparent black, or use load() or other Fill functions</span>
</span></code></pre></div> <p><strong>When to use:</strong> All composition, effects, and color operations. This is your default choice.</p> <hr> <h3 id=imageu8-8-bit-precision><code>ImageU8</code> - 8-bit Precision</h3> <p>Storage-optimized type for loading/saving. Stores RGBA data as unsigned 8-bit integers (0 to 255 range). <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>ImageU8</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>
</span><span id=__span-2-3><a id=__codelineno-2-3 name=__codelineno-2-3 href=#__codelineno-2-3></a><span class=c1># Typically used internally by load/save</span>
</span><span id=__span-2-4><a id=__codelineno-2-4 name=__codelineno-2-4 href=#__codelineno-2-4></a><span class=n>u8_img</span> <span class=o>=</span> <span class=n>ImageU8</span><span class=p>(</span><span class=n>width</span><span class=o>=</span><span class=mi>1920</span><span class=p>,</span> <span class=n>height</span><span class=o>=</span><span class=mi>1080</span><span class=p>)</span>
</span></code></pre></div></p> <p><strong>When to use:</strong> Rarely needed directly. <code>load()</code> and <code>save()</code> handle conversions automatically.</p> <hr> <h2 id=memory-management>Memory Management</h2> <p>PyImageCUDA offers three memory management approaches:</p> <h3 id=1-automatic-garbage-collection>1. Automatic (Garbage Collection)</h3> <p>Simplest approach. Python's GC cleans up when images go out of scope. <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>Fill</span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=n>Fill</span><span class=o>.</span><span class=n>color</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>
</span><span id=__span-3-5><a id=__codelineno-3-5 name=__codelineno-3-5 href=#__codelineno-3-5></a><span class=c1># img will be freed automatically when no longer referenced</span>
</span></code></pre></div></p> <p>Use when: Writing simple scripts or prototypes.</p> <hr> <h3 id=2-explicit-with-context-managers>2. Explicit with Context Managers</h3> <p>Immediate cleanup using <code>with</code> statements. Example - Batch Processing: <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>load</span><span class=p>,</span> <span class=n>save</span><span class=p>,</span> <span class=n>Filter</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1000</span><span class=p>):</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=k>with</span> <span class=n>load</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;input_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>.jpg&quot;</span><span class=p>)</span> <span class=k>as</span> <span class=n>img</span><span class=p>:</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a>        <span class=n>Filter</span><span class=o>.</span><span class=n>gaussian_blur</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>radius</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a>        <span class=n>save</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;output_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>.jpg&quot;</span><span class=p>)</span>
</span><span id=__span-4-7><a id=__codelineno-4-7 name=__codelineno-4-7 href=#__codelineno-4-7></a>    <span class=c1># Each image is freed before loading the next</span>
</span></code></pre></div></p> <hr> <h3 id=3-manual-control>3. Manual Control</h3> <p>Explicit <code>free()</code> calls for maximum control. <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>Fill</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=n>Fill</span><span class=o>.</span><span class=n>color</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>1</span><span class=p>))</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=n>img</span><span class=o>.</span><span class=n>free</span><span class=p>()</span>  <span class=c1># Free immediately</span>
</span></code></pre></div></p> <p>Use when: You need precise control over when memory is released.</p> <h3 id=4-handling-out-of-memory>4. Handling Out of Memory</h3> <p>When GPU memory is exhausted, you'll see: <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=ne>RuntimeError</span><span class=p>:</span> <span class=n>CUDA</span> <span class=n>malloc</span> <span class=n>failed</span><span class=p>:</span> <span class=n>out</span> <span class=n>of</span> <span class=n>memory</span>
</span></code></pre></div></p> <p>This is a <strong>clear signal</strong> that your GPU has run out of VRAM. Check your memory usage and consider freeing unused buffers or reducing workload size.</p> <hr> <h2 id=buffer-reuse>Buffer Reuse</h2> <p>All operations that create temporary buffers accept optional buffer parameters for zero-allocation workflows.</p> <p>Buffers can be larger than necessary but not smaller. If they are larger, their logical dimensions will be adapted within the function without any performance cost, but the original maximum size with which it was created will be maintained.</p> <h3 id=example-gaussian-blur>Example: Gaussian Blur</h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>Filter</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=n>src</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a><span class=n>dst</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a><span class=n>temp</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a><span class=c1># Process 100 images reusing the same buffers</span>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>100</span><span class=p>):</span>
</span><span id=__span-7-9><a id=__codelineno-7-9 name=__codelineno-7-9 href=#__codelineno-7-9></a>    <span class=n>load</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;input_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>.jpg&quot;</span><span class=p>,</span> <span class=n>f32_buffer</span><span class=o>=</span><span class=n>src</span><span class=p>)</span>
</span><span id=__span-7-10><a id=__codelineno-7-10 name=__codelineno-7-10 href=#__codelineno-7-10></a>    <span class=n>Filter</span><span class=o>.</span><span class=n>gaussian_blur</span><span class=p>(</span><span class=n>src</span><span class=p>,</span> <span class=n>dst_buffer</span><span class=o>=</span><span class=n>dst</span><span class=p>,</span> <span class=n>temp_buffer</span><span class=o>=</span><span class=n>temp</span><span class=p>)</span>
</span><span id=__span-7-11><a id=__codelineno-7-11 name=__codelineno-7-11 href=#__codelineno-7-11></a>    <span class=n>save</span><span class=p>(</span><span class=n>dst</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&quot;output_</span><span class=si>{</span><span class=n>i</span><span class=si>}</span><span class=s2>.jpg&quot;</span><span class=p>)</span>
</span><span id=__span-7-12><a id=__codelineno-7-12 name=__codelineno-7-12 href=#__codelineno-7-12></a>
</span><span id=__span-7-13><a id=__codelineno-7-13 name=__codelineno-7-13 href=#__codelineno-7-13></a><span class=c1># Clean up once</span>
</span><span id=__span-7-14><a id=__codelineno-7-14 name=__codelineno-7-14 href=#__codelineno-7-14></a><span class=n>src</span><span class=o>.</span><span class=n>free</span><span class=p>()</span>
</span><span id=__span-7-15><a id=__codelineno-7-15 name=__codelineno-7-15 href=#__codelineno-7-15></a><span class=n>dst</span><span class=o>.</span><span class=n>free</span><span class=p>()</span>
</span><span id=__span-7-16><a id=__codelineno-7-16 name=__codelineno-7-16 href=#__codelineno-7-16></a><span class=n>temp</span><span class=o>.</span><span class=n>free</span><span class=p>()</span>
</span></code></pre></div> <p>Benefits:</p> <ul> <li>No repeated allocations</li> <li>Consistent VRAM usage</li> <li>Critical for video processing</li> </ul> <hr> <h2 id=dynamic-buffer-sizing>Dynamic Buffer Sizing</h2> <p>Image buffers have a fixed capacity but adjustable logical dimensions. <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=kn>from</span><span class=w> </span><span class=nn>pyimagecuda</span><span class=w> </span><span class=kn>import</span> <span class=n>Image</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=c1># Create buffer with capacity for 1920×1080</span>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=n>img</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a>
</span><span id=__span-8-6><a id=__codelineno-8-6 name=__codelineno-8-6 href=#__codelineno-8-6></a><span class=c1># Can logically resize within capacity</span>
</span><span id=__span-8-7><a id=__codelineno-8-7 name=__codelineno-8-7 href=#__codelineno-8-7></a><span class=n>img</span><span class=o>.</span><span class=n>width</span> <span class=o>=</span> <span class=mi>1280</span>
</span><span id=__span-8-8><a id=__codelineno-8-8 name=__codelineno-8-8 href=#__codelineno-8-8></a><span class=n>img</span><span class=o>.</span><span class=n>height</span> <span class=o>=</span> <span class=mi>720</span>
</span><span id=__span-8-9><a id=__codelineno-8-9 name=__codelineno-8-9 href=#__codelineno-8-9></a>
</span><span id=__span-8-10><a id=__codelineno-8-10 name=__codelineno-8-10 href=#__codelineno-8-10></a><span class=c1># Check capacity</span>
</span><span id=__span-8-11><a id=__codelineno-8-11 name=__codelineno-8-11 href=#__codelineno-8-11></a><span class=n>max_w</span><span class=p>,</span> <span class=n>max_h</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>get_max_capacity</span><span class=p>()</span>
</span><span id=__span-8-12><a id=__codelineno-8-12 name=__codelineno-8-12 href=#__codelineno-8-12></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Capacity: </span><span class=si>{</span><span class=n>max_w</span><span class=si>}</span><span class=s2>×</span><span class=si>{</span><span class=n>max_h</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>  <span class=c1># 1920×1080</span>
</span><span id=__span-8-13><a id=__codelineno-8-13 name=__codelineno-8-13 href=#__codelineno-8-13></a><span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&quot;Current: </span><span class=si>{</span><span class=n>img</span><span class=o>.</span><span class=n>width</span><span class=si>}</span><span class=s2>×</span><span class=si>{</span><span class=n>img</span><span class=o>.</span><span class=n>height</span><span class=si>}</span><span class=s2>&quot;</span><span class=p>)</span>  <span class=c1># 1280×720</span>
</span></code></pre></div></p> <p>Use case: Loading variable-sized images into fixed buffers. <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=n>buffer</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>4096</span><span class=p>,</span> <span class=mi>4096</span><span class=p>)</span>  <span class=c1># Max capacity</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=k>for</span> <span class=n>filename</span> <span class=ow>in</span> <span class=n>images</span><span class=p>:</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a>    <span class=n>load</span><span class=p>(</span><span class=n>filename</span><span class=p>,</span> <span class=n>f32_buffer</span><span class=o>=</span><span class=n>buffer</span><span class=p>)</span>  <span class=c1># Adjusts buffer dimensions</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>    <span class=n>process</span><span class=p>(</span><span class=n>buffer</span><span class=p>)</span>
</span></code></pre></div></p> <hr> <h2 id=best-practices>Best Practices</h2> <h3 id=for-simple-scripts>For Simple Scripts</h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Just use automatic GC</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>img</span> <span class=o>=</span> <span class=n>load</span><span class=p>(</span><span class=s2>&quot;input.jpg&quot;</span><span class=p>)</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=n>process</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=n>save</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=s2>&quot;output.jpg&quot;</span><span class=p>)</span>
</span></code></pre></div> <h3 id=for-batch-processing>For Batch Processing</h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=c1># Use with statements</span>
</span><span id=__span-11-2><a id=__codelineno-11-2 name=__codelineno-11-2 href=#__codelineno-11-2></a><span class=k>for</span> <span class=n>file</span> <span class=ow>in</span> <span class=n>files</span><span class=p>:</span>
</span><span id=__span-11-3><a id=__codelineno-11-3 name=__codelineno-11-3 href=#__codelineno-11-3></a>    <span class=k>with</span> <span class=n>load</span><span class=p>(</span><span class=n>file</span><span class=p>)</span> <span class=k>as</span> <span class=n>img</span><span class=p>:</span>
</span><span id=__span-11-4><a id=__codelineno-11-4 name=__codelineno-11-4 href=#__codelineno-11-4></a>        <span class=n>process</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span><span id=__span-11-5><a id=__codelineno-11-5 name=__codelineno-11-5 href=#__codelineno-11-5></a>        <span class=n>save</span><span class=p>(</span><span class=n>img</span><span class=p>,</span> <span class=n>output</span><span class=p>)</span>
</span></code></pre></div> <h3 id=for-videoreal-time>For Video/Real-time</h3> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># Reuse buffers explicitly</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>frame</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=n>temp</span> <span class=o>=</span> <span class=n>Image</span><span class=p>(</span><span class=mi>1920</span><span class=p>,</span> <span class=mi>1080</span><span class=p>)</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=k>while</span> <span class=n>video</span><span class=o>.</span><span class=n>has_frames</span><span class=p>():</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a>    <span class=n>video</span><span class=o>.</span><span class=n>read_into</span><span class=p>(</span><span class=n>frame</span><span class=p>)</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a>    <span class=n>process</span><span class=p>(</span><span class=n>frame</span><span class=p>,</span> <span class=n>temp_buffer</span><span class=o>=</span><span class=n>temp</span><span class=p>)</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a>    <span class=n>video</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>frame</span><span class=p>)</span>
</span><span id=__span-12-9><a id=__codelineno-12-9 name=__codelineno-12-9 href=#__codelineno-12-9></a>
</span><span id=__span-12-10><a id=__codelineno-12-10 name=__codelineno-12-10 href=#__codelineno-12-10></a><span class=n>frame</span><span class=o>.</span><span class=n>free</span><span class=p>()</span>
</span><span id=__span-12-11><a id=__codelineno-12-11 name=__codelineno-12-11 href=#__codelineno-12-11></a><span class=n>temp</span><span class=o>.</span><span class=n>free</span><span class=p>()</span>
</span></code></pre></div> <hr> <h2 id=memory-considerations>Memory Considerations</h2> <p>VRAM vs RAM:</p> <ul> <li><code>Image(1920, 1080)</code> uses ~32MB of VRAM</li> <li>Python object itself uses &lt;100 bytes of RAM</li> <li>GC triggers on RAM pressure, not VRAM pressure, use explicit management for large workloads</li> </ul> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/offerrall/pyimagecuda target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "content.code.copy", "content.code.annotate", "toc.integrate", "navigation.tabs.sticky", "navigation.top"], "search": "../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../assets/javascripts/bundle.e71a0d61.min.js></script> </body> </html>